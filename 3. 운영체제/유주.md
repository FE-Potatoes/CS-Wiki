# 유주

# 운영체제

## 3.1 운영체제와 컴퓨터

컴퓨터 = 운영체제(하드웨어 + 소프트웨어를 관리하는 일꾼) + CPU + 메모리 등

### 3.1.1 운영체제의 역할과 구조

#### 운영체제 역할

1. CPU 스케줄링과 프로세스 관리 : 프로세스 생성, 삭제 , CPU 등의 자원 할당 등을 관리
2. 메모리 관리 : 한정된 메모리를 프로세스에 얼마나 할당할지
3. 디스크 파일 관리 : 디스크 파일을 어떻게 보관할지
4. I/O 디바이스 관리 : 마우스, 키보드 등과 컴퓨터가 데이터를 주고받는 것 관리

#### 운영체제 구조

(- 유저 프로그램)

- 인터페이스 (GUI, CUI) -> 여기서부터
- 시스템콜
- 커널 (드라이버, 파일 시스템) -> 여기까지가 운영체제
  (- 하드웨어)

[ 용어 ]
GUI : 사용자가 전자장치와 상호 작용할 수 있도록 하는 사용자 인터페이스 형태 (동작 기반)
드라이버 : 하드웨어를 제어하기 위한 소프트웨어
CUI : 그래픽이 아닌 명령어로 처리하는 인터페이스
I/O 요청 : 입출력 함수, 데이터베이스, 네트워크, 파일 접근 등에 관한 일
드라이버 : 하드웨어를 제어하기 위한 소프트웨어
modebit : 1 또는 0의 값을 가지는 플래그 변수 ( 0은 커널 모드, 1은 유저 모드 )
유저 모드 : 유저가 접근할 수 있는 영역을 제한적으로 두며 컴퓨터 자원에 함부로 침범하지 못하게 하는 모드
커널 모드 : 모든 컴퓨터 자원에 접근할 수 있는 모드
커널 : 운영체제의 핵심 부분이자 시스템콜 인터페이스를 제공하며 보안, 메모리, 프로세스, 파일 시스템, I/O 등 운영체제의 중추적인 역할을 한다.

[ 시스템콜 ]
: 운영체제가 커널에 접근하기 위한 인터페이스

- 운영체제의 서비스를 받기 위해 커널 함수를 호출할 때 사용
- 유저 프로그램이 I/O 요청으로 트랩을 발동하면 올바른 요청인지 확인 후 유저 모드가 시스템콜을 통해 커널모드로 변환되어 실행된다.

### 3.1.2 컴퓨터의 요소

- CPU, DMA 컨트롤러, 메모리, 타이머, 디바이스 컨트롤러 등

#### CPU (Central Processing Unit)

: 산술논리연산장치, 제어장치, 레지스터로 구성되어 있는 컴퓨터 장치

- 인터럽트에 의해 메모리에 존재하는 명령어를 해석하여 실행한다.
- 제어장치(CU, Control Unit) : 프로세스 조작을 지시하는 CPU의 한 부품
- 레지스터 : CPU 안에 있는 매우 빠른 임시기억장치
- 산술논리연산장치(ALU) : 덧셈, 뺄셈 같은 두 숫자의 산술 연산과 배타적 논리합,논리곱 같은 논리 연산 계산 회로

[ CPU 의 연산처리 ]

1. 제어장치가 메모리와 레지스터에 계산할 값을 로드한다.
2. 제어장치가 레지스터에 있는 값을 계산하라고 산술논리연산장치에 명령한다.
3. 제어장치가 계산된 값을 다시 레지스터에서 메모리로 계산한 값을 저장한다.

[ 인터럽트 ]
: 어떤 신호가 왔을 때 CPU를 잠깐 정지시키는 것

- 인터럽트 핸들러 함수가 실행된다.

1. 하드웨어 인터럽트 : 키보드,마우스 등 IO 디바이스에서 발생하는 인터럽트
   운영체제에 시스템콜을 요청해서 디바이스에 있는 작은 로컬 버퍼에 접근하여 일을 수행한다.
2. 소프트웨어 인터럽트 : 트랩, 프로세스가 시스템콜을 호출할 때 발동한다.

#### DMA 컨트롤러

: IO 디바이스가 메모리에 직접 접근할 수 있도록 하는 하드웨어 장치

- CPU 부하를 막아주는 보조 일꾼
- 하나의 작업을 CPU와 DMA 컨트롤러가 동시에 하는 것을 방지한다.

#### 메모리

: 전자회로에서 데이터나 상태, 명령어 등을 기록하는 장치= 작업장

- 보통 RAM을 뜻함
- CPU 는 계산, 메모리는 기억을 담당한다.

#### 타이머

: 몇 초 안에는 작업이 끝나야 한다는 것을 정하고 특정 프로그램에 시간 제한을 다는 역할

#### 디바이스 컨트롤러

: 컴퓨터와 연결되어 있는 IO 디바이스들의 작은 CPU

## 3.2 메모리

### 3.2.1 메모리 계층

레지스터, 캐시, 메모리, 저장장치로 구성

1. 레지스터 : CPU 안에있는 작은 메모리, 휘발성, 속도 빠름, 기억 용량 가장 적음
2. 캐시 : L1,L2,L3 캐시 , 휘발성, 속도 빠름, 기억 용량 적음
3. 주기억장치 : = RAM, 휘발성, 속도 보통, 기억 용량 보통
4. 보조기억장치 : = HDD, SSD, 비휘발성, 속도 낮음, 기억 용량 많음

램의 역할 : 하드디스크로부터 일정량의 데이터를 복사해서 임시 저장하고, 이를 필요 시마다 CPU에 빠르게 전달한다.
로딩 중인 경우는 하드디스크 또는 인터넷에서 데이터를 읽어 RAM으로 전송하는 과정이 끝나지 않은 것.

#### 캐시

: 데이터를 미리 복사해 놓는 임시 저장소이자 빠른 장치와 느린 장치 속도 차이에 따른 병목 현상을 줄이기 위한 메모리

- 데이터 접근 시간 해소, 다시 계산하는 시간 절약
- 메모리와 CPU 속도 차이를 레지스터 계층을 통해 해결
  => 계층과 계층 사이 속도 차이 해결을 위한 계층 = 캐싱 계층

[ 지역성 ]

1. 시간 지역성
   : 최근 사용한 데이터에 다시 접근하려는 특성
   ex. for문의 i

2. 공간 지역성
   : 최근 접근한 데이터를 이루고 있는 공간이나 그 가까운 공간에 접근하는 특성
   ex. for문의 배열 arr

#### 캐시히트와 캐시미스

캐시히트 : 캐시에서 원하는 데이터를 찾음, 제어장치를 거쳐 가져온다. 빠르다.
캐시미스 : 데이터가 없을 때 주메모리에서 데이터를 찾음. 느리다.

[ 캐시매핑 ]
: 캐시가 히트되기 위해 매핑하는 방법

- CPU의 레지스터와 주메모리(램) 간에 데이터를 주고받을 때 레지스터가 캐시 계층으로써 역할을 해야한다.

1. 직접 매핑 : 순서대로 매핑하는것 , 출동할수있다.
2. 연관 매핑 : 순서 상관없이 관련 있는 캐시와 메모리를 매핑, 충돌이 적지만 느리다
3. 집합 연관 매핑 : 직접+연관 매핑 , 순서는 일치시키지만 집합을 둬서 저장하여 블록화한다.

[ 웹브라우저의 캐시 ]

- 보통 사용자의 커스텀한 정보나 인증 모듈 관련 사항들을 저장

1. 쿠키 : 만료기한이 있는 키-값 저장소

- same site 옵션을 strict 로 설정하지 않으면 다른 도메인에서 요청했을 때 자동 전송된다.
- ~4KB, 만료기한 설정 가능 (보통 서버에서)
- document.cookie로 쿠키를 볼 수 없게 httponly 옵션을 걸어야한다.

2. 로컬 스토리지

- 만료기한이 없는 키-값 저장소
- ~5MB, 웹브라우저를 닫아도 유지
- 클라이언트에서만 수정 가능

3. 세션 스토리지

- 만료기한이 없는 키-값 저장소
- ~5MB, 탭을 닫으면 데이터 삭제됨
- 클라이언트에서만 수정 가능

### 3.2.2 메모리 관리

#### 가상 메모리

: 메모리 관리 기법, 컴퓨터가 실제 이용 가능한 메모리 자원을 추상화하여 사용자들에게 매우 큰 메모리로 보이게 만드는 것

- 가상 주소가 메모리관리장치(MMU)에 의해 실제 메모리상에 있는 실제 주소로 변환된다.
- 가상 메모리는 가상 주소와 실제 주소가 매핑되어 있고, 프로세스의 주소 정보가 들어 있는 페이지 테이블로 관리된다.
- TLB 로 속도향상
  \*\* TLB : 메모리와 CPU 사이에 있는 주소 변환을 위한 캐시

[ 스와핑 ]
: 메모리에서 당장 사용하지 않는 영역을 하드디스크로 옮기고, 하드디스크의 일부분을 메모리처럼 불러와 쓰는 것

- 페이지 폴트가 발생하지 않은 것 처럼 만든다.
- 스와핑 발생시 페이지 테이블을 갱신시키고 해당 명령어를 다시 시작한다.

[ 페이지 폴트 ]
: 가상 메모리(프로세스의 주소 공간)에는 있지만 실제 메모리인 RAM 에는 없는 데이터나 코드에 접근할 때 발생한다.

#### 스레싱(thrashing)

: 메모리의 페이지 폴트율이 높은 것을 의미한다.
\*\* 페이지 : 가상 메모리를 사용하는 최소 크기 단위

- 컴퓨터의 심각한 성능 저하 초래
- 메모리에 많은 프로세스 진행시 스와핑이 많이 일어나서 발생

페이지 폴트 발생 => 스와핑 발생 => CPU 이용률 낮아짐 => 운영체제가 CPU 가 노는줄 알고 더 많은 프로세스를 메모리에 올림
=> 스레싱 발생
해결 방법 : 1. 메모리 늘리기 2. HDD를 SSD로 변경 3. 작업 세트 4. PFF

[ 작업 세트 ]
: 프로세스의 과거 사용 이력인 지역성을 통해 결정된 페이지 집합을 만들어서 미리 메모리에 로드하는 것

- 탐색 비용과 스와핑을 줄일 수 있다.

[ PFF(Page Fault Frequency) ]
: 페이지 폴트 빈도를 조절하는 방법으로 상한선과 하한선을 만든다.

- 상한선 도달시 프레임을 늘리고, 하한선 도달시 프레임을 줄인다.

#### 메모리 할당

- 메모리에 프로그램을 할당할 때는 시작 메모리 위치, 메모리의 할당 크기를 기반으로 할당한다.

1. 연속 할당
   : 메모리에 연속적으로 공간을 할당한다.

- 고정 분할 방식 : 메모리를 미리 나누어 관리
- 가변 분할 방식 : 매 시점 프로그램의 크기에 맞게 동적으로 메모리를 나눠 사용 ( 최초/최적/최악 적합)

2. 불연속 할당
   : 메모리를 연속적으로 할당하지 않는다.

- 페이징 : 동일한 크기의 페이지 단위로 나누어 메모리의 서로 다른 위치에 프로세스를 할당한다.
- 세그멘테이션 : 페이지 단위가 아닌 의미 단위인 세그먼트로 나누는 방식
- 페이지드 세그멘테이션 : 프로그램을 의미 단위인 세그먼트로 나눠 보안과 공유 측면에 강점을 두고, 동일한 크기의 페이지 단위로 나누는 것

#### 페이지 교체 알고리즘

- 오프라인 알고리즘 : 먼 미래에 참조되는 페이지와 현재 할당하는 페이지를 바꾸는 알고리즘
- FIFO : 가장 먼저 온 페이지를 교체영역에 가장 먼저 놓는 방법
- LRU : least recently used, 참조가 가장 오래된 페이지를 바꾸는 방법
- NUR : not used recently,
- LFU : least frequently used, 가장 참조가 적은(적게 사용된) 페이지를 교체

## 3.3 프로세스와 스레드

프로세스 : 컴퓨터에서 실행되고 있는 프로그램, CPU 스케줄링의 대상이 되는 작업
스레드 : 프로세스 내 작업의 흐름을 지칭

### 3.3.1 프로세스와 컴파일 과정

프로세스 : 프로그램이 메모리에 올라가 인스턴스화 된 것 (ex. 구글 -> 구글 크롬 프로세스)
컴파일러가 컴파일 과정을 통해 언어를 기계어로 번역
ex. 소스 코드 파일 -> 전처리 -> 컴파일러 -> 어셈블리어 -> 어셈블러 -> 목적코드 -> 라이브러리 + 링커 -> 실행 가능한 파일

- 전처리 : 소스 코드의 주석 제거, 헤더 파일을 병합하여 메크로를 치환
- 컴파일러 : 오류 처리, 코드 최적화 작업으로 어셈블리어로 변환
- 어셈블러 : 목적 코드로 변환
- 링커 : 라이브러리 함수 또는 다른 파일과 목적 코드를 결합하여 실행 파일을 만든다. (.exe, .out)

### 3.3.2 프로세스의 상태

- 생성 상태 (create) : fork(), exec() 함수로 프로세스가 생성된다.

* fork() : 부모 프로세스의 주소 공간을 그대로 복사하여 새로운 자식 프로세스를 생성하는 함수
* exec() : 새롭게 프로세스를 생성하는 함수

- 대기상태(ready) : 메모리 공간이 충분할 때만 메모리를 할당받는다. CPU 소유권이 넘어오길 기다린다.

- 대기 중단 상태(ready suspended) : 메모리 부족으로 일시 중단 상태

- 실행 상태 (running) : CPU 소유권과 메모리를 할당받고 인스트럭션을 수행중인 상태를 의미
  = CPU burst

- 중단 상태 (blocked) : 이벤트 발생 후 기다리며 프로세스가 차단된 상태

- 일시 중단 상태( blocked suspended): 대기 중단과 유사, 중단된 상태에서 프로세스를 시작하려했으나 메모리 부족으로 일시 중지

- 종료 상태 (terminated) : 메모리와 CPU 소유권을 모두 놓고 가는 상태
  자연스러운 종료, 자발적 종료(abort)

### 3.3.3 프로세스의 메모리 구조

메모리 할당 구조
스택+힙(동적 영역) / 데이터 영역+코드 영역(정적 영역)

#### 스택과 힙

- 동적할당 = 런타임 단계에서 메모리를 할당받는다.
- 스택은 지역변수,매개변수,실행되는 함수에 의해 늘거나 줄어드는 메모리 영역
- 특정 정보가 스택에 계속 쌓인다.

- 힙은 동적으로 할당되는 변수

#### 데이터 영역과 코드 영역

- 정적 할당되는 영역 = 컴파일 단계에서 메모리를 할당한다.
- 데이터 영역: 전역 변수, static , const 로 선언, 초기화 값 없거나 0
- 코드 영역 : 전역 변수, static , const 로 선언, 초기화 값이 0이 아님

# 지연
네트워크 기초
네트워크
- 노드와 링크가 서로 연결되어 있으며 리소스를 공유하는 집합
- 많은 트래픽을 처리할 수 있으며, 지연 시간이 짧고 장애 빈도가 적으며 좋은 보안을 갖춰야 함

네트워크 토폴로지
- 노드와 링크가 어떻게 배치되어 있는지에 대한 방식이자 연결 형태
- 종류
  - 트리 토폴로지 : 계층형 / 노드의 추가, 삭제가 쉽고 하위 노드에 영향
  - 버스 토폴로지 : 중앙 통신 회선 하나에 여러 개의 노드가 연결되어 공유하는 네트워크 구성, 근거리 통신망에서 사용, 스푸핑(스위칭 기능을 마비시켜 패킷이 악의적인 수신부로 전달됨) 가능 문제
  - 스타 토폴로지 : 중앙 노드에 모두 연결된 네트워크 구성, 노드 추가, 에러 탐지가 쉬움, 패킷의 충돌 발생 가능성이 적음, 중앙 노드 문제 발생 시 전체 네트워크 마비 및 고가의 설치 비용 존재
  - 링형 토폴로지 : 각 노드가 양 옆의 두 노드와 연결되며 연속된 길을 통해 통신하는 망 구성 방식, 노드에서 노드로 데이터가 이동, 네트워크 구성 변경이 어렵고 회선 장애 시 전체 네트워크에 영향
  - 메시 토폴로지 : 그물망처럼 연결된 구조, 한 단말 장치에도 여러 개의 경로가 존재하므로 네트워크 문제 발생 시에도 트래픽 분산 처리 가능, 노드 추가가 어렵고 고가의 설치 비용 존재
- 전체 시스템의 성능이나 용량이 하나의 구성 요소로 인해 제한 받는 현상인 ‘병목 현상’을 올바르게 처리하기 위해 토폴로지가 활용됨

네트워크 분류
- LAN : 근거리 통신망, 전송 속도가 빠르고 혼잡하지 않음
- MAN : 대도시 지역 네트워크, 전송 속도 평균이며 LAN보다 혼잡
- WAN : 광역 네트워크, 전송 속도는 낮으며 MAN보다 혼잡

네트워크 성능 분석
- 네트워크 병목 현상의 주된 원인 : 네트워크 대역폭, 네트워크 토폴로지, 서버 CPU, 메모리 사용량, 비효율적 네트워크 구성
- Ping : 네트워크 상태를 확인하기 위해 대상 노드를 향해 일정 크기의 패킷을 전송하는 명령어, 해당 노드의 패킷 수신 상태와 연결 여부 확인 가능
- netstat : 접속된 서비스들의 네트워크 상태를 표시하는데 사용
- nslookup : DNS에 관련된 내용을 확인하기 위해 쓰는 명령어, 매핑된 IP를 확인하기 위해 사용
- tracert : 목적지 노드까지 네트워크 경로를 확인할 때 사용하는 명령어, 어느 구간에서 응답 시간이 느려지는지 알 수 있음

### TCP/IP 4계층 모델
Transmission Control Protocol, Internet Protocol
네트워크 에서 사용되는 통신 프로토콜의 집합

총 4개의 계층을 가지며, 애플리케이션 계층 / 전송 계층 / 인터넷 계층 / 링크 계층 으로 구성

- 애플리케이션 계층
  - FTP(장치와 장치 간 파일 전송에 사용되는 프로토콜), HTTP(웹 사이트를 이용하는 데 쓰이는 프로토콜), SSH(암호화 네트워크 프로토콜), SMTP(전자 메일 전송을 위한 통신 프로토콜), DNS(도메인 이름과 IP 주소 매핑) 등 응용 프로그램이 사용되는 프로토콜 계층
  - 웹 서비스, 이메일 등 서비스가 제공되는 계층
- 전송 계층
  - 송신자와 수신자를 연결하는 통신 서비스를 제공
  - 애플리케이션 계층과 인터넷 계층 사이의 데이터가 전달될 때 중계 역할을 함
  - TCP
    - 패킷 사이 순서를 보장, 수신 여부 확인, 가상회선 패킷 교환 방식 사용
  - UDP
    - 순서 보장x, 수신 여부 확인x, 데이터그램 패킷 교환 방식 사용
  - TCP 연결 성립 과정에서 ‘**3-way handshake**’ 작업 진행 => ‘신뢰성 구축’
    - SYN 단계 : ISN(Initial Sequence Number) 를 담아 클라이언트 -> 서버 전달
    - SYN - ACK 단계 : 서버가 SYN을 수신해 서버의 ISN을 보내며 승인번호로 ISN + 1를 클라이언트로 전달
    - ACK 단계 : 클라이언트는 ISN + 1 승인번호를 담아 서버에 전달
  - TCP 연결 해제 가정에서 ‘**4-way handshake**’ 작업 진행 
    - 1단계 : 클라이언트가 FIN으로 설정된 세그먼트를 서버로 전달, 클라이언트는 FIN_WAIT_1
    - 2단계 : 서버는 ACK 승인 세그먼트를 클라이언트로 전달, 서버는 CLOSE_WAIT / 클라이언트는 ACK를 받으면 FIN_WAIT_2
    - 3단계 : 서버는 ACK 전달 뒤 일정 시간 이후 FIN 세그먼트를 클라이언트로 전달
    - 4단계 : 클라이언트는 TIME_WAIT 상태에서 ACK를 서버로 전달하면 서버는 CLOSED 상태, 이후 클라이언트도 일정 시간 대기 후 연결 해제
    - ** TIME_WAIT 은 지연 패킷으로 인한 무결성 문제, 장치간 연결이 올바르게 닫혔는지 확인하기 위해 대기 시간이 필요하기에 사용 **
- 인터넷 계층
  - 장치로부터 받은 네트워크 패킷을 IP 주소로 지정된 목적지로 전송하기 위해 사용되는 계층
  - 주소를 지정해 데이터를 전달하며, IP, ARP, ICMP 등이 있음
  - 비연결형적인 특징으로 전달이 올바른지에 대해 보장하지 않음
- 링크 계층
  - 실질적으로 데이터를 전달하며 장치 간 신호를 주고 받는 규칙을 정하는 계층
  - 네트워크 접근 계층, 2가지로 나뉘기도 함
  - (1) 물리 계층 : 무선 LAN과 유선 LAN을 통해 0과 1로 이루어진 데이터를 보내는 계층
  - (2) 데이터 링크 계층 : 이더넷 프레임을 통해 에러 확인, 흐름 제어, 접근 제어를 담당하는 계층

계층 간 데이터 송수신 과정
- HTTP를 통해 웹 서버에 있는 데이터를 요청하는 경우?
  - 애플리케이션 -> 전송 계층 : 요청 값이 캡슐화(상위 계층의 헤더와 데이터를 하위의 데이터 부분에 포함 + 헤더 삽입) 과정을 거쳐 전달
  - 링크 계층 : 서버와 통신
  - 해당 웹 서버의 링크 계층 -> 애플리케이션 계층까지 비캡슐화 과정을 거쳐 데이터 전송

PDU
Protocol Data Unit
네트워크의 계층에서 계층으로 데이터가 전달될 때의 단위
- 애플리케이션 계층 : 메시지
- 전송 계층 : 세그먼트 (TCP), 데이터그램 (UDP)
- 인터넷 계층 : 패킷
- 링크 계층 : 프레임(데이터 링크 계층), 비트(물리 계층)

### 네트워크 기기
계층별로 처리 범위를 나눌 수 있으며, 상위 계층 -> 하위 계층 처리 가능하지만 반대는 불가
- 애플리케이션 계층 : L7 스위치(로드 밸런서, 서버의 부하를 분산해 요청을 여러 서버로 나눠 트래픽 증가를 목표로 함)
- 인터넷 계층 : 라우터, L3 스위치
- 데이터 링크 계층 : L2 스위치, 브리지
- 물리 계층 : NIC, 리피터, AP
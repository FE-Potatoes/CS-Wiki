# 선아

# 2.1 네트워크 기초

### 처리량

- 초당 전송/수신 비트수
- 단위: bps
- 트래픽, 네트워크 장치 간 대역폭, 네트워크 에러, 장치 하드웨어 스펙의 영향을 받음

### 지연시간

- 요청이 처리되는 시간 = 어떤 메시지가 두 장치를 왕복하는 데 걸린 시간
- 유/무선, 패킷 크기, 라우터의 패킷 처리 시간의 영향을 받음

### 네트워크 토폴로지

- 네트워크 내에서 노드와 링크 연결 방식
- 병목 현상 해결을 위해 네트워크 구조를 아는 것이 중요
- 종류
  1. 트리 토폴로지 = 계층형 토폴로지
     - 트리 형태의 네트워크 구성
     - 노드 추가/삭제가 쉬움
     - 특정 노드에 트래픽이 집중될 때 하위 노드 영향 O
  2. 버스 토폴로지
     - 중앙 통신 회선 하나에 여러 개의 노드가 연결되어 있는 네트워크
     - LAN에서 사용하는 구조
     - 장점
       1. 설치 비용이 적음
       2. 신뢰성 우수
       3. 노드 추가/삭제가 쉬움
     - 단점
       1. 스푸핑 발생 가능
          - 공격자가 IP주소를 위조하여 메시지 전송 → 수신자는 위조된 IP주소로 메시지 응답 → 해당 IP주소는 원치 않은 데이터를 수신함 (DoS 공격)
  3. 스타 토폴로지
     - 중앙에 있는 노드와 모두 연결된 네트워크 구성
     - 장치 간 직접적인 연결이 없고, 모든 통신은 중앙 노드를 통해 전달됨
     - 장점
       1. 에러 탐지 용이
       2. 패킷 충돌 발생 가능성 적음 ← 모든 장치가 중앙 노드와 각각 독립된 1:1 연결을 맺고 있기 때문
     - 단점: 중앙 노드에 장애 발생시, 전체 네트워크를 사용할 수 없게 됨
  4. 링형 토폴로지
     - 각 노드가 양 옆의 두 노드와 연결되어 있는 구성 방식
     - 보통 한 방향을 정해서, 그 방향으로만 데이터를 보냄
     - 장점
       1. 네트워크 상 손실이 적음 ← 목적지가 자신이 아니면, 프레임을 다음 노드에 전달하는 단순한 방식을 사용하기 때문에, 네트워크가 확장되어도 중간 노드가 복잡한 판단을 하지 않음
       2. 노드의 고장 발견을 쉽게 찾을 수 있음 ← 한 방향으로 보내다가 어느 지점에서 끊기면, 그 노드가 문제이기 때문
     - 단점
       1. 회선 장애 발생시 전체 네트워크에 영향 발생
       2. 네트워크 구성 변경이 어려움 ← 노드 추가/삭제시 함께 연결된 다른 노드의 회선까지 함께 건드려야 하기 때문
  5. 메시 토폴로지 = 망형 토폴로지
     - 그물망 구조
     - 장점
       1. 한 단말 장치에 장애가 발생해도 전체 네트워크 영향 X ← 경로가 여러 개 존재하기 때문
       2. 트래픽 분산 처리 가능
     - 단점
       1. 노드 추가 어려움
       2. 구축 비용 고가

## 네트워크 분류

### LAN (Local Area Network)

- 근거리 통신망 = 같은 IP 대역을 사용하는 네트워크 매체들을 묶는 네트워크
- 허브/스위치로 연결된 소규모 네트워크
- MAN, WAN보다 높은 안정성 & 속도
- 유선 매체 - Ethernet 케이블 사용. 무선 매체 - Wi Fi

### MAN (Metropolitan Area Network)

- 2개 이상의 LAN으로 이루어진 네트워크
- 각 LAN은 라우터, 브리지 등으로 연결됨
- 전송 매체: 광섬유, 동축 케이블
- 이중 버스 토폴로지 사용

cf) 라우터: 패킷 위치를 기반으로 최적의 경로를 지정하여, 그 경로를 따라 패킷을 다음 장치로 이동시키는 장치

### WAN

- 국가 간 통신망
- Internet

# 2.2 TCP/IP 4계층 모델

![image.png](attachment:11834ea9-8b6d-4265-8685-504f2cf5e7f6:image.png)

### Application Layer

- 응용 프로그램이 사용되는 프로토콜 계층
- FTP, HTTP, SSH, SMTP, DNS
- 처리 장치: L7 스위치
  - 역할: 로드밸런서(서버 부하 분산 기기)
  - URL, 서버, 캐시, 쿠키를 기반으로 트래픽 분산
  - 바이러스, 불필요한 외부 데이터를 걸러내는 필터링 기능

### Transport Layer

- TCP 내용 정리
  - transmission control protocol
  - 연결 지향 방식. 가상회선 패킷 교환 방식
    - 패킷 전송을 위한 논리적 경로를 배정
    - 3 way handshake로 연결 → 4 way handshake로 해제
    - TCP Handshake
      - 시작: 3 way handshake
        - 정상적인 시작 과정
          1. SYN 전송
          2. SYN 수신 후 SYN-ACK 전송
          3. SYN-ACK 수신 후 ACK 전송 (연결됨)
      - 종료: 4 way handshake
        ![image.png](attachment:aa8a0df9-5846-4d84-8a69-24498ca5416a:image.png)
        - RST: TCP 연결 강제 종료시 사용. 연결 즉시 종료
        - 정상적인 종료 과정
          1. 클라이언트가 FIN 전송
             - 클라이언트: FIN-WAIT-1 상태가 됨
          2. 서버에서 FIN 수신 후 ACK 전송
             - 서버: CLOSE-WAIT(상대방의 FIN(종료 요청)을 받은 상태)
             - 클라이언트: FIN-WAIT-2 상태가 됨 (Half Close 상태)
               → 나는 더 이상 보낼 게 없지만, 서버가 보낼 데이터는 더 받을 수 있는 상태
          3. 서버가 FIN 전송
             - 클라이언트 상태: TIME-WAIT
          4. 클라이언트가 FIN 수신 후 ACK 전송
  - 순서 보장
    - 패킷마다 sequence number를 가지고 있음
    - 수신 측에서 sequence number를 보고 정렬 + 누락 체크
  - 흐름제어 : 송/수신 데이터 처리 속도를 조절하여 수신자의 버퍼 오버플로우를 방지
    - 수신측이 송신측에게 자신의 상태를 지속적으로 알림
    - 수신측에서 데이터 받을 준비가 되었을 때 송신측에서 패킷을 보냄
    - 왜? 송신속도 > 수신속도라면 전송된 패킷이 drop되는 경우가 발생하기 때문
    - 종류
      - stop and wait: 매번 전송한 패킷에 대한 확인 응답(ack)을 받아야 그 다음 패킷 전송
      - sliding window: 수신측이 받을 수 있는 데이터의 양을 알려주기 때문에 패킷마다 응답을 받을 필요 없음
        1. 예) 송신측은 총 6개의 패킷을 보내야 함. 수신측으로부터 받은 윈도우크기와 네트워크 상황을 고려하여 자신의 윈도우크기를 지정
        2. 윈도우크기만큼 수신측에게 전송
        3. 수신측은 `내가 지금까지 연속으로 잘 받은 마지막 seq num + 1`을 송신측에게 보냄
        4. 송신측은 윈도우를 움직여서 수신측에서 원하는 seq num을 가진 패킷부터 또 보냄
        https://evan-moon.github.io/2019/11/22/tcp-flow-control-error-control/
  - 오류 제어 :
    - Go Back N
      - ACK를 3번 보내서 (3 Ack Duplicated) 필요한 패킷이 오지 않았음을 알림
        - 예) ACK 2를 3번 보냄: 2번 이후의 패킷은 받았지만 2번이 아직 도착하지 않았음을 알림
      - 수신측: N번이 도착하지 않았다면, N번 이후의 패킷을 모두 폐기
      - 송신측: N번부터 전부 다 다시 보냄
    - Selective Repeat
      - SACK(Selective ACK) 사용. 어디까지 받았고, 무엇이 오지 않았는지를 알려줌
        - 예) ACK 2, SACK 3-4 : 2번 받아야 하는데 3, 4번만 받았음
      - 받아야 하는 패킷만 선택해서 보냄
  - 혼잡제어 : 네트워크 내 패킷 수가 넘치지 않도록 방지
    - 네트워크에 연결된 호스트가 너무 많을 떄
    - Slow Start
      - 윈도우 크기를 1부터 시작
      - ACK 하나 받을 때마다 제곱으로 커짐 (1 → 2 → 4 → 8 … )
      - 혼잡 감지시 윈도우 크기를 1로 줄임
    - AIMD(Additive Increase / Multicative Decrease)
      - ACK 하나 받을 때마다 윈도우 크기 +1
      - 혼잡 감지시 윈도우 크기를 절반으로 줄임
      - 네트워크에 참여한 순서와 관계 없이, 모든 호스트의 윈도우 크기가 하나의 값으로 수렴하게 됨
        - why? 먼저 들어와서 윈도우 크기가 커진 애는 윈도우 크기를 줄여 혼잡상황을 해결하려 하고, 나중에 들어온 애는 윈도우 크기가 점점 커지기 때문 (이 과정이 반복)
      - 문제점: 네트워크 대역폭이 남는 상황에서도 윈도우 크기를 천천히 늘리기 때문에, 네트워크의 모든 대역을 활용하기까지 시간이 걸림
    - Slow Start로 시작 → ssthreshold(slow start threshold) 이상이 되면 AIMD로 전환하는 방법을 사용 중
      - TCP Reno
        - 타임아웃인 경우(네트워크 완전 붕괴로 간주): AIMD → Slow Start로 전환
        - 3 Ack Duplicated인 경우(일부 패킷 유실로 간주) : AIMD 유지
      - TCP Tahoe
        - 두 경우 모두 AIMD → Slow Start로 전환
    - https://evan-moon.github.io/2019/11/26/tcp-congestion-control/
  - 높은 신뢰성
  - UDP보다 속도가 느림
    - 연결 & 해제 과정이 존재하기 때문
    - 순서성이 보장되어야 하기 때문에 패킷을 중간부터 다시 보내야하는 경우가 생기기 때문
    - 혼잡제어때문에 한번에 보낼 수 있는 패킷 수가 제어되기 때문
- UDP 내용 정리
  - UDP = user datagram protocol
  - 데이터그램 기반 프로토콜 → handshake 과정 필요 X
    - 패킷 간 순서가 정해져 있지 않음
    - 패킷의 목적지만 정해져 있다면 중간 경로는 알바 아님
- 전송 단위: TCP - 세그먼트 / UDP - 데이터그램
- 처리 장치: L4 스위치
  - 역할: 로드밸런서
  - IP 주소 + 포트번호 기반으로 트래픽 분산
  - 스트리밍 관련 서비스에서는 사용 불가 → 이전에 이 클라이언트 요청을 어느 서버로 보냈었는지를 기억해서 그 다음에도 같은 서버로 보내줘야 하는데, UDP(주로 스트리밍 서비스)는 비연결형 방식이라 이전 기록을 기억/추적하기가 어려움. 그러나 UDP에서 완전히 불가능한 것은 아니다.

### Network Layer

- 네트워크 패킷을 IP주소로 전송하기 위해 사용되는 계층
- 상대방이 제대로 받았는지 확인하지 않는 비연결형적인 특징을 가지고 있음
- IP, ARP, ICMP
- 전송 단위: 패킷
- 처리 장치: 라우터 & L3 스위치
  - 여러 개의 LAN을 구분하고, 연결시켜주는 장비
  - 경로 최적화 기능을 가지고 있음

### Data Link Layer

- 이던세 프레임을 통해 에러 확인, 흐름제어, 접근제어를 담당하는 계층
- 전선, 광섬유, 무선으로 데이터 전달
- 전송 단위: 프레임
- 처리 장치
  1. L2 스위치
     - MAC 주소 테이블을 통해 장치들의 MAC 주소 관리
     - 연결된 장치로부터 패킷이 왔을 때 패킷 전송을 담당함
     - IP(X) MAC(O) 주소 기반 라우팅
  2. 브리지
     - 하나의 LAN 안에서 세그먼트들을 상호 접속할 수 있게 하는 통신망 연결 장치
     - 통신망 범위를 확장할 때 사용
     - cf) 세그먼트란? 하나의 LAN 안에서 충돌이 발생할 수 있는 영역
     - cf) 여기서의 충돌: 같은 네트워크 매체를 여러 장비가 동시에 사용하려고 해서 데이터 신호가 겹쳐지는 현상. 전송 회선을 공유할 때, 누군가 데이터 보내는 동안 다른 데이터가 겹치면 전기신호가 겹쳐서 해석 불가능한 신호가 되어버림 → 충돌을 피하기 위해 LAN을 여러 개의 세그먼트로 나누고 그걸 브리지로 이어서 충돌을 피한다
  3. AP
     - 패킷 복사 기기
     - 무선 기기가 유선 네트워크에 접속할 수 있게 해주는 장치

### Physical Layer

- 0/1로 이루어진 이진 데이터 전송
- 처리 장치
  1. NIC = LAN 카드 (1-2 계층 통합 담당)
     - 기기를 네트워크에 연결해주는 장치
     - LAN 카드마다 고유의 MAC 주소를 가지고 있음
  2. 리피터:
     - 약해진 신호를 재생하고 증폭해서 더 먼 거리로 보내주는 장치
     - 유선 네트워크의 거리 한계를 극복하기 위해 사용 → 최근에는 광케이블 사용으로 잘 사용하지 X

### 캡슐화 & 비캡슐화

- 캡슐화: 상위 계층의 헤더와 데이터를 하위 계층의 데이터 부분에 포함시키고 + 해당 계층의 헤더를 삽입하는 과정
- 비캡슐화: 하위 → 상위로 가며 각 계층의 헤더를 제거하는 과정
